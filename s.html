<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STERLA - Full Learning App</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.15.0/flowchart.min.js"></script>
<style>
:root{
  --black:#0b0b0d; --card:#111216; --light-blue:#84d2ff; --light-purple:#c2b3ff;
  --muted:#9aa0b4; --white:#ffffff; --success:#3cd48b; --danger:#e55a5a;
}
*{box-sizing:border-box;font-family:Inter,Poppins,sans-serif;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0d 0%,#0f1724 100%);color:var(--white);}
#loginPage{height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.login-card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:28px;border-radius:20px;width:360px;box-shadow:0 12px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);}
.login-card h2{margin-bottom:8px;color:var(--light-purple)}
.login-card p{color:var(--muted);margin-bottom:16px}
.input{width:100%;padding:12px;border-radius:12px;border:none;margin:8px 0;background:rgba(255,255,255,0.03);color:var(--white);outline:none}
.btn{width:100%;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;cursor:pointer;font-weight:700}
.small-btn{padding:8px 12px;border-radius:10px;border:none;background:transparent;color:var(--light-blue);cursor:pointer}
#appPage{display:none;height:100vh;display:flex;overflow:hidden}
#sidebar{width:260px;background:linear-gradient(180deg,#071028,#0b1633);padding:28px;color:var(--white);border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:14px}
.brand{font-size:28px;font-weight:800;color:var(--light-purple);letter-spacing:1px}
.nav-btn{background:transparent;border:none;color:var(--muted);padding:12px 14px;text-align:left;border-radius:10px;cursor:pointer;font-weight:700}
.nav-btn.active, .nav-btn:hover{background:rgba(255,255,255,0.02);color:var(--white);box-shadow:0 6px 20px rgba(124,107,255,0.08)}
#main{flex:1;overflow:auto;padding:30px;background:linear-gradient(180deg,#0b0f1a 0%,#0b1220 30%)}
#welcomeBox{background:linear-gradient(180deg,#071028,#0b1430);border-radius:16px;padding:26px;color:var(--white);display:flex;justify-content:space-between;align-items:center;gap:20px}
#welcomeBox h2{color:var(--light-blue);font-size:22px;margin:0}
#welcomeBox p{margin:0;color:var(--muted)}
.subject-grid{margin-top:18px;display:flex;flex-wrap:wrap;gap:18px}
.subject-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:20px;border-radius:14px;width:200px;cursor:pointer;box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02);font-weight:800;color:var(--light-blue);text-align:center}
.subject-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(6,10,40,0.8)}
.page{display:none}
.page.active{display:block}
#diagramContainer{background:linear-gradient(180deg,#071427,#02101a);border-radius:14px;padding:20px;min-height:500px;border:1px solid rgba(255,255,255,0.03);margin-top:20px}
#diagram{width:100%;height:500px}
.output-box{background:linear-gradient(180deg,#061022,#081428);padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);color:var(--white);overflow:auto;max-height:400px}
#chatBox{background:#061025;padding:12px;border-radius:12px;min-height:360px;max-height:520px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
.chat-input{margin-top:12px;display:flex;gap:12px}
.chat-input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
.chat-input button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;font-weight:800}
#homeworkPage textarea{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:#061025;color:#fff;resize:vertical}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:26px;padding:10px 18px;border-radius:999px;font-weight:700}
.toast.success{background:var(--success);color:#000}
.toast.error{background:var(--danger);color:#fff}
@media (max-width:900px){#sidebar{display:none}#main{padding:18px}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-card">
    <h2>STERLA</h2>
    <p>Select your role to continue</p>
    <select id="roleSelect" class="input">
      <option value="">Choose role</option>
      <option value="Student">Student</option>
      <option value="Teacher">Teacher</option>
    </select>
    <button class="btn" onclick="onLogin()">Login</button>
    <p id="loginMessage" style="color:var(--danger);min-height:18px"></p>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
      <button class="small-btn" onclick="onLogin(true)">Continue as Guest</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appPage">
  <aside id="sidebar">
    <div class="brand">STERLA</div>
    <button class="nav-btn active" data-page="homePage" onclick="navigate(event)">Home</button>
    <button class="nav-btn" data-page="subjectsPage" onclick="navigate(event)">Subjects</button>
    <button class="nav-btn" data-page="topicPage" onclick="navigate(event)">Topics</button>
    <button class="nav-btn" data-page="mindmapPage" onclick="navigate(event)">Flowchart</button>
    <button class="nav-btn" data-page="quizPage" onclick="navigate(event)">Quiz</button>
    <button class="nav-btn" data-page="wsPage" onclick="navigate(event)">Worksheet</button>
    <button class="nav-btn" data-page="homeworkPage" onclick="navigate(event)">Homework</button>
    <button class="nav-btn" data-page="aiChatPage" onclick="navigate(event)">AI Chat</button>
    <div style="flex:1"></div>
  </aside>

  <main id="main">
    <section id="homePage" class="page active">
      <div id="welcomeBox">
        <div>
          <h2>Welcome to STERLA</h2>
          <p>Your learning companion — choose a subject and topic to get started.</p>
        </div>
        <div style="text-align:right;color:var(--muted)">
          <div id="welcomeUser">Guest</div>
        </div>
      </div>
      <h3 style="color:var(--light-blue);margin-top:8px">Quick Subjects</h3>
      <div class="subject-grid" id="subjectsQuick"></div>
    </section>

    <section id="subjectsPage" class="page">
      <h3>All Subjects</h3>
      <div class="subject-grid" id="subjectsList"></div>
    </section>

    <section id="topicPage" class="page">
      <h3>Topics</h3>
      <div class="subject-grid" id="topicsList"></div>
    </section>

    <section id="mindmapPage" class="page">
      <h3>Flowcharts - All Subjects</h3>
      <div style="margin-bottom:20px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <select id="mindmapTopicSelect" class="input" style="flex:1;min-width:250px">
          <option value="">Select Any Subject/Topic</option>
        </select>
        <button class="btn" onclick="generateFlowchart()">Generate Flowchart</button>
      </div>
      <div id="diagramContainer">
        <div id="diagram" style="text-align:center;padding:40px;color:var(--muted)">
          Select topic → Generate Flowchart
        </div>
      </div>
    </section>

    <section id="quizPage" class="page">
      <h3>Quiz</h3>
      <div id="quizOutput" class="output-box">Select a topic to start quiz</div>
    </section>

    <section id="wsPage" class="page">
      <h3>Worksheet</h3>
      <div id="wsOutput" class="output-box">Select a topic to view worksheet</div>
    </section>

    <section id="homeworkPage" class="page">
      <h3>Homework</h3>
      <div class="output-box" style="padding:24px">
        <textarea id="homeworkInput" rows="6" placeholder="Write homework answers..." style="width:100%;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:12px;color:var(--white)"></textarea>
        <button class="btn" onclick="submitHomework()" style="margin-top:12px">Submit Homework</button>
        <div id="homeworkMessage"></div>
      </div>
    </section>

    <section id="aiChatPage" class="page">
      <h3>AI Chat</h3>
      <div id="chatBox"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Ask about any topic..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </section>
  </main>
</div>

<script>
// Subjects List
const allSubjects = [
  "Grammar","Formal Letter","Speech","Prose","Algebra","Linear Equations","Mensuration",
  "Reproduction in Animals","Sound","Electricity","1857 Revolt","Resources","Judiciary",
  "Vyakaran","Patra Lekhan","HTML","AI Basics","Shabd Roop","Dhatu Roop","French Grammar",
  "Culture","Networks","Cybersecurity"
];

// Quiz Bank (samples for brevity - expand properly in your code)
const quizBank = {
  "Grammar":[
    {q:"Select the noun.", options:["Run","Dog","Quickly","Beautiful"], answer:"Dog"},
    {q:"Identify the verb.", options:["Is","Happy","Table","Red"], answer:"Is"},
    {q:"What is an adjective?", options:["A person","A place","A describing word","A thing"], answer:"A describing word"},
    {q:"Which word is an adverb?", options:["Quickly","Run","Sun","Beautiful"], answer:"Quickly"},
    {q:"Choose the correct pronoun.", options:["He","Fast","Apple","Blue"], answer:"He"},
    {q:"What is an article?", options:["A describing word","An action word","A kind of word","A word that defines"], answer:"A kind of word"},
    {q:"Find the conjunction.", options:["And","Run","Beautiful","He"], answer:"And"},
    {q:"Verb shows what?", options:["Action","Place","Person","Color"], answer:"Action"},
    {q:"What is a preposition?", options:["Shows relationship","An action","A noun","An adjective"], answer:"Shows relationship"},
    {q:"Identify the interjection.", options:["Wow","Run","Fast","He"], answer:"Wow"}
  ],
  "Formal Letter":[
    {q:"Best salutation for formal letter?", options:["Dear Sir","Hey","Yo","Hi buddy"], answer:"Dear Sir"},
    {q:"Where date should go?", options:["Top right","Middle","Bottom left","Nowhere"], answer:"Top right"},
    {q:"Best closing in formal letter?", options:["Yours sincerely","Bye","Cheers","Later"], answer:"Yours sincerely"},
    {q:"Is slang allowed?", options:["No","Yes","Sometimes","Optional"], answer:"No"},
    {q:"Purpose of formal letter?", options:["Official communication","Chatting","Story","Email to friend"], answer:"Official communication"},
    {q:"Where subject line appears?", options:["Below date","Above date","Bottom","Nowhere"], answer:"Below date"},
    {q:"Best tone?", options:["Polite","Casual","Angry","Funny"], answer:"Polite"},
    {q:"Formal letter is?", options:["Professional","Informal","Funny","Story"], answer:"Professional"},
    {q:"Should address be included?", options:["Yes","No","Optional","Sometimes"], answer:"Yes"},
    {q:"Formal letter language?", options:["Formal","Slang","Casual","Mixed"], answer:"Formal"}
  ],
  // Add similarly for other subjects...
};

// Worksheet Bank sample entries (expand as needed)
const wsBank = {
  "Grammar": [
    "Write 5 nouns.",
    "Write 5 verbs.",
    "Identify parts of speech in a paragraph.",
    "Form 5 adverbs.",
    "Write 3 complex sentences."
  ],
  "Formal Letter": [
    "Write a formal letter to principal.",
    "Draft a complaint letter.",
    "Compose letter to editor.",
    "Write letter to bank manager.",
    "Write letter to teacher."
  ],
  // Add similarly for other subjects...
};

// AI Chat Bank sample Q&A (expand per your content)
const aiBank = {
  "Grammar": [
    {q:"noun", a:"A noun is a person, place, thing, or idea."},
    {q:"verb", a:"A verb is an action or state of being."},
    {q:"adjective", a:"Adjectives describe nouns or pronouns."},
    {q:"conjunction", a:"Conjunctions connect words, phrases, or clauses."},
    {q:"pronoun", a:"Pronouns replace nouns."}
  ],
  "Formal Letter": [
    {q:"formal letter", a:"A formal letter is written for official or professional purposes."},
    {q:"salutation", a:"Use a polite greeting such as 'Dear Sir or Madam.'"},
    {q:"closing", a:"End with 'Yours sincerely' or 'Yours faithfully.'"},
    {q:"date placement", a:"The date is placed at the top right corner of the letter."},
    {q:"body content", a:"Keep the letter clear, concise, and polite."}
  ],
  // Add similarly for other subjects...
};

// Flowchart Definitions (example for a few subjects)
const flowchartDefinitions = {
  "Grammar": `st=>start: Grammar\nps=>operation: Parts of Speech\nNoun→Verb→Adjective→Adverb\ntense=>operation: Present, Past & Future Tense\nend=>end: Grammar Mastered\nst->ps->tense->end`,
  "Formal Letter": `st=>start: Formal Letter\naddr=>operation: Sender Address\ndate=>operation: Date\nsub=>operation: Subject\nbody=>operation: Letter Content\nclose=>operation: Yours sincerely\nend=>end: Completed\nst->addr->date->sub->body->close->end`,
  // Add similarly for the rest of all subjects
};

// Variables for user/session state
let userName = null, userRole = null, chosenTopic = null;

// Login function
function onLogin(guest=false){
  const msg = document.getElementById('loginMessage');
  msg.textContent = '';
  if(!guest){
    const role = document.getElementById('roleSelect').value;
    if(!role){ msg.textContent = 'Select Student or Teacher'; return; }
    userName = role + " User"; userRole = role;
  } else {
    userName = 'Guest'; userRole = 'Guest';
  }
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('appPage').style.display = 'flex';
  document.getElementById('welcomeUser').innerText = userName;
  loadSubjects();
  showToast(`Welcome ${userName}!`, 'success');
}

// Navigation handler
function navigate(e){
  if(!e) return;
  document.querySelectorAll('#sidebar .nav-btn').forEach(btn => btn.classList.remove('active'));
  e.currentTarget.classList.add('active');
  let page = e.currentTarget.dataset.page;
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(page).classList.add('active');
  if(page === 'subjectsPage') loadSubjects();
  else if(page === 'mindmapPage') loadFlowchartTopics();
  else if(page === 'quizPage') loadQuiz();
  else if(page === 'wsPage') loadWorksheet();
}

// Load all subjects into UI
function loadSubjects(){
  const quick = document.getElementById('subjectsQuick');
  const list = document.getElementById('subjectsList');
  quick.innerHTML = ''; list.innerHTML = '';
  allSubjects.forEach(sub => {
    const btnQuick = document.createElement('button');
    btnQuick.className = 'subject-card'; btnQuick.innerText = sub;
    btnQuick.onclick = () => selectTopic(sub);
    quick.appendChild(btnQuick);
    const btnList = document.createElement('button');
    btnList.className = 'subject-card'; btnList.innerText = sub;
    btnList.onclick = () => selectTopic(sub);
    list.appendChild(btnList);
  });
}

// Set selected topic and update state
function selectTopic(topic) {
  chosenTopic = topic;
  showToast(`Selected topic: ${topic}`, 'success');
  loadQuiz();
  loadWorksheet();
  clearChat();
}

// Load flowchart topics dropdown
function loadFlowchartTopics() {
  const select = document.getElementById('mindmapTopicSelect');
  select.innerHTML = '<option value="">Select Any Subject/Topic</option>';
  allSubjects.forEach(topic => {
    const option = document.createElement('option');
    option.value = topic;
    option.textContent = topic;
    select.appendChild(option);
  });
}

// Generate flowchart with flowchart.js
function generateFlowchart(){
  const topic = document.getElementById('mindmapTopicSelect').value || chosenTopic;
  const container = document.getElementById('diagram');
  if(!topic || !flowchartDefinitions[topic]){
    showToast('Please select a valid subject/topic!', 'error');
    return;
  }
  container.innerHTML = '<div style="text-align:center;padding:20px;color:var(--muted)">Generating flowchart...</div>';
  try {
    const chart = flowchart.parse(flowchartDefinitions[topic]);
    chart.drawSVG('diagram', {
      'line-width': 3,
      'line-length': 50,
      'text-margin': 15,
      'font-size': 14,
      'font': 'Inter, sans-serif',
      'font-color': '#ffffff',
      'line-color': '#84d2ff',
      'element-color': '#84d2ff',
      'fill': '#071f35',
      'yes-text': '✓',
      'no-text': '✗',
      'arrow-end': 'block',
      'symbols': {
        'start': {'font-color': '#3cd48b', 'element-color': '#3cd48b', 'fill': '#102b16'},
        'end': {'font-color': '#ff6b9d', 'element-color': '#ff6b9d', 'fill': '#2b1019'}
      },
      'scale': 1
    });
    showToast(`✅ ${topic} Flowchart Generated!`, 'success');
  } catch(e) {
    console.error(e);
    showToast('Error generating flowchart', 'error');
  }
}

// Load and display quiz questions for chosen topic
function loadQuiz() {
  const out = document.getElementById('quizOutput');
  out.innerHTML = '';
  if (!chosenTopic || !quizBank[chosenTopic]) {
    out.textContent = 'No quiz available for selected topic.';
    return;
  }
  quizBank[chosenTopic].forEach((qObj, idx) => {
    const div = document.createElement('div');
    div.style.marginBottom = '10px';
    const p = document.createElement('p');
    p.textContent = `${idx + 1}. ${qObj.q}`;
    div.appendChild(p);
    qObj.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.style.marginRight = '8px';
      btn.onclick = () => {
        if (opt === qObj.answer) showToast('✅ Correct!');
        else showToast('❌ Wrong answer!');
      };
      div.appendChild(btn);
    });
    out.appendChild(div);
  });
}

// Load and display worksheet tasks for chosen topic
function loadWorksheet() {
  const out = document.getElementById('wsOutput');
  out.innerHTML = '';
  if (!chosenTopic || !wsBank[chosenTopic]) {
    out.textContent = 'No worksheet available for selected topic.';
    return;
  }
  out.innerHTML = '<ol>' + wsBank[chosenTopic].map(task => `<li>${task}</li>`).join('') + '</ol>';
}

// Clear AI chat box on topic change
function clearChat() {
  const chatBox = document.getElementById('chatBox');
  chatBox.innerHTML = '';
  document.getElementById('chatInput').value = '';
}

// AI chat send message function with friendly defaults
function sendMessage() {
  const input = document.getElementById('chatInput');
  const chatBox = document.getElementById('chatBox');
  let msg = input.value.trim();
  if (!msg) return;
  input.value = '';
  chatBox.innerHTML += `<div><b>You:</b> ${msg}</div>`;
  let reply = 'Please select a topic to get relevant answers.';
  if (chosenTopic && aiBank[chosenTopic]) {
    let matched = aiBank[chosenTopic].find(o => msg.toLowerCase().includes(o.q.toLowerCase()));
    reply = matched
      ? matched.a
      : `I can answer questions about ${chosenTopic}. Please ask something specific.`;
  }
  chatBox.innerHTML += `<div><b>AI:</b> ${reply}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Submit homework and clear
function submitHomework() {
  const ta = document.getElementById('homeworkInput');
  const msg = document.getElementById('homeworkMessage');
  if (ta.value.trim().length === 0) {
    msg.style.color = '#e55a5a';
    msg.textContent = 'Please enter your homework before submitting.';
    return;
  }
  msg.style.color = '#3cd48b';
  msg.textContent = '✅ Homework submitted successfully!';
  ta.value = '';
  setTimeout(() => {
    msg.textContent = '';
  }, 3000);
}

// Toast message helper
function showToast(msg, type = 'success') {
  let t = document.createElement('div');
  t.className = 'toast ' + (type === 'success' ? 'success' : 'error');
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 2500);
}

// Initial load
window.onload = () => {
  loadSubjects();
};
</script>

</body>
</html>
