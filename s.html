<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STERLA - Integrated Mindmap + ChatGPT</title>
<style>
:root{
  --black:#0b0b0d; --card:#111216; --light-blue:#84d2ff; --light-purple:#c2b3ff;
  --muted:#9aa0b4; --white:#ffffff; --success:#3cd48b; --danger:#e55a5a;
}
*{box-sizing:border-box;font-family:Inter,Poppins,sans-serif;}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0d 0%,#0f1724 100%);color:var(--white);}
#loginPage{height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
.login-card{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:28px;border-radius:20px;width:360px;box-shadow:0 12px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.03);}
.login-card h2{margin-bottom:8px;color:var(--light-purple)}
.login-card p{color:var(--muted);margin-bottom:16px}
.input{width:100%;padding:12px;border-radius:12px;border:none;margin:8px 0;background:rgba(255,255,255,0.03);color:var(--white);outline:none}
.btn{width:100%;padding:12px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;cursor:pointer;font-weight:700}
.small-btn{padding:8px 12px;border-radius:10px;border:none;background:transparent;color:var(--light-blue);cursor:pointer}
#appPage{display:none;height:100vh;display:flex;overflow:hidden}
#sidebar{width:260px;background:linear-gradient(180deg,#071028,#0b1633);padding:28px;color:var(--white);border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:14px}
.brand{font-size:28px;font-weight:800;color:var(--light-purple);letter-spacing:1px}
.nav-btn{background:transparent;border:none;color:var(--muted);padding:12px 14px;text-align:left;border-radius:10px;cursor:pointer;font-weight:700}
.nav-btn.active, .nav-btn:hover{background:rgba(255,255,255,0.02);color:var(--white);box-shadow:0 6px 20px rgba(124,107,255,0.08)}
#main{flex:1;overflow:auto;padding:30px;background:linear-gradient(180deg,#0b0f1a 0%,#0b1220 30%)}
#welcomeBox{background:linear-gradient(180deg,#071028,#0b1430);border-radius:16px;padding:26px;color:var(--white);display:flex;justify-content:space-between;align-items:center;gap:20px}
#welcomeBox h2{color:var(--light-blue);font-size:22px;margin:0}
#welcomeBox p{margin:0;color:var(--muted)}
.subject-grid{margin-top:18px;display:flex;flex-wrap:wrap;gap:18px}
.subject-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:20px;border-radius:14px;width:200px;cursor:pointer;box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02);font-weight:800;color:var(--light-blue);text-align:center}
.subject-card:hover{transform:translateY(-6px);box-shadow:0 18px 50px rgba(6,10,40,0.8)}
.page{display:none}
.page.active{display:block}
.output-box{background:linear-gradient(180deg,#061022,#081428);padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02);color:var(--white)}
#mindmapContainer{background:linear-gradient(180deg,#071427,#02101a);border-radius:14px;padding:30px;min-height:600px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
.flowchart{overflow-x:auto;display:flex;justify-content:center;align-items:center;min-height:500px;padding:20px}
.flow-node{position:relative;display:inline-block;margin:20px;background:linear-gradient(135deg,#071f35,#0a2540);border:2px solid #84d2ff;border-radius:12px;padding:16px 20px;text-align:center;min-width:140px;box-shadow:0 8px 25px rgba(132,210,255,0.15);transition:all 0.3s ease;white-space:nowrap}
.flow-node:hover{transform:translateY(-5px);box-shadow:0 15px 35px rgba(132,210,255,0.25)}
.flow-node.start{background:linear-gradient(135deg,#3cd48b,#2eb67d);border-color:#3cd48b}
.flow-node.process{background:linear-gradient(135deg,#84d2ff,#c2b3ff);border-color:#84d2ff;color:#001}
.flow-node.decision{background:linear-gradient(135deg,#ff9f43,#ff8b00);border-color:#ff9f43}
.flow-node.end{background:linear-gradient(135deg,#ff6b9d,#ff4d82);border-color:#ff6b9d}
.flow-arrow{position:absolute;width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-top:20px solid #84d2ff;transform:translateX(-50%);z-index:10}
.flow-arrow.right{left:100%;top:50%;transform:translate(10px,-50%) rotate(0deg)}
.flow-arrow.down{top:100%;left:50%;transform:translate(-50%,10px) rotate(90deg)}
.flow-node .title{font-weight:800;font-size:14px;margin-bottom:8px}
.flow-node .points{font-size:12px;line-height:1.4}
#chatBox{background:#061025;padding:12px;border-radius:12px;min-height:360px;max-height:520px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
.chat-input{margin-top:12px;display:flex;gap:12px}
.chat-input input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff}
.chat-input button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--light-blue),var(--light-purple));color:#001;font-weight:800}
#homeworkPage textarea{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:#061025;color:#fff;resize:vertical}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:26px;padding:10px 18px;border-radius:999px;font-weight:700}
.toast.success{background:var(--success);color:#000}
.toast.error{background:var(--danger);color:#fff}
@media (max-width:900px){#sidebar{display:none}#main{padding:18px}}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-card">
    <h2>STERLA</h2>
    <p>Select your role to continue</p>
    <select id="roleSelect" class="input">
      <option value="">Choose role</option>
      <option value="Student">Student</option>
      <option value="Teacher">Teacher</option>
    </select>
    <button class="btn" onclick="onLogin()">Login</button>
    <p id="loginMessage" style="color:var(--danger);min-height:18px"></p>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
      <button class="small-btn" onclick="onLogin(true)">Continue as Guest</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appPage">
  <aside id="sidebar">
    <div class="brand">STERLA</div>
    <button class="nav-btn active" data-page="homePage" onclick="navigate(event)">Home</button>
    <button class="nav-btn" data-page="subjectsPage" onclick="navigate(event)">Subjects</button>
    <button class="nav-btn" data-page="topicPage" onclick="navigate(event)">Topics</button>
    <button class="nav-btn" data-page="mindmapPage" onclick="navigate(event)">Flowchart</button>
    <button class="nav-btn" data-page="quizPage" onclick="navigate(event)">Quiz</button>
    <button class="nav-btn" data-page="wsPage" onclick="navigate(event)">Worksheet</button>
    <button class="nav-btn" data-page="homeworkPage" onclick="navigate(event)">Homework</button>
    <button class="nav-btn" data-page="aiChatPage" onclick="navigate(event)">AI Chat</button>
    <div style="flex:1"></div>
  </aside>

  <main id="main">
    <section id="homePage" class="page active">
      <div id="welcomeBox">
        <div>
          <h2>Welcome to STERLA</h2>
          <p>Your learning companion — choose a subject and topic to get started.</p>
        </div>
        <div style="text-align:right;color:var(--muted)">
          <div id="welcomeUser">Guest</div>
        </div>
      </div>
      <h3 style="color:var(--light-blue);margin-top:8px">Quick Subjects</h3>
      <div class="subject-grid" id="subjectsQuick"></div>
    </section>

    <section id="subjectsPage" class="page">
      <h3>Subjects</h3>
      <div class="subject-grid" id="subjectsList"></div>
    </section>

    <section id="topicPage" class="page">
      <h3>Topics</h3>
      <div class="subject-grid" id="topicsList"></div>
    </section>

    <section id="mindmapPage" class="page">
      <h3>Topic Flowchart</h3>
      <div style="margin-bottom:20px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <select id="mindmapTopicSelect" class="input" style="flex:1;min-width:200px">
          <option value="">Select Grammar, Algebra, etc.</option>
        </select>
        <button class="btn" onclick="generateFlowchart()">Generate Flowchart</button>
      </div>
      <div id="mindmapContainer" class="flowchart">
        <div style="text-align:center;padding:60px;color:var(--muted);font-size:18px">
          Select a topic → Generate Flowchart<br>
          <small>Watch the step-by-step learning flow!</small>
        </div>
      </div>
    </section>

    <section id="quizPage" class="page">
      <h3>Quiz</h3>
      <div id="quizOutput" class="output-box"></div>
    </section>

    <section id="wsPage" class="page">
      <h3>Worksheet</h3>
      <div id="wsOutput" class="output-box"></div>
    </section>

    <section id="homeworkPage" class="page">
      <h3>Homework Submitter</h3>
      <div style="background:linear-gradient(180deg,#061022,#081428);padding:24px;border-radius:16px;border:1px solid rgba(255,255,255,0.02);">
        <textarea id="homeworkInput" rows="8" placeholder="Write your homework answers here..."></textarea>
        <div style="margin-top:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <button class="btn" onclick="submitHomework()" style="flex:1;min-width:200px">Submit Homework</button>
        </div>
        <div id="homeworkMessage" style="margin-top:12px;padding:12px;border-radius:10px;display:none"></div>
      </div>
    </section>

    <section id="aiChatPage" class="page">
      <h3>AI Chat</h3>
      <div id="chatBox"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Ask a question..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </section>
  </main>
</div>

<script>
// ========== GLOBALS ==========
let userName = null, userRole = null;
let selectedSubject = null, chosenTopic = null;

// ========== FLOWCHART DATA - STEP BY STEP LEARNING FLOW ==========
const flowchartData = {
  "Grammar": {
    steps: [
      {type: "start", title: "Grammar", points: "Master Language Rules"},
      {type: "process", title: "Parts of Speech", points: "Noun•Verb•Adjective<br>Adverb•Pronoun"},
      {type: "decision", title: "Sentence?", points: "Types→Decl•Interro<br>Exclam•Imperative"},
      {type: "process", title: "Tenses", points: "Present•Past•Future<br>Perfect forms"},
      {type: "end", title: "Mastered!", points: "Perfect sentences!"}
    ]
  },
  "Formal Letter": {
    steps: [
      {type: "start", title: "Formal Letter", points: "Official Communication"},
      {type: "process", title: "Sender Info", points: "Address•Date"},
      {type: "process", title: "Receiver", points: "Address•Salutation"},
      {type: "process", title: "Body", points: "Intro•Main•Conclusion"},
      {type: "end", title: "Complete!", points: "Yours sincerely"}
    ]
  },
  "Speech": {
    steps: [
      {type: "start", title: "Speech", points: "Public Speaking"},
      {type: "process", title: "Opening", points: "Attention grabber"},
      {type: "process", title: "Body", points: "Main points"},
      {type: "decision", title: "Closing?", points: "Summary•Memorable end"},
      {type: "end", title: "Delivered!", points: "Applause!"}
    ]
  },
  "Algebra": {
    steps: [
      {type: "start", title: "Algebra", points: "Math with Variables"},
      {type: "process", title: "Variables", points: "x, y, constants"},
      {type: "process", title: "Equations", points: "Solve x+5=12"},
      {type: "decision", title: "Simplify?", points: "Factor•Expand"},
      {type: "end", title: "Solved!", points: "x=7"}
    ]
  },
  "Linear Equations": {
    steps: [
      {type: "start", title: "Linear Eqs", points: "y=mx+c"},
      {type: "process", title: "One Variable", points: "2x+3=7 → x=2"},
      {type: "process", title: "Two Variables", points: "Substitution"},
      {type: "decision", title: "Graph?", points: "Straight line"},
      {type: "end", title: "Solutions!", points: "Complete!"}
    ]
  }
};

// ========== LOGIN ==========
function onLogin(guest=false){
  const msg = document.getElementById('loginMessage');
  msg.textContent='';
  if(!guest){
    const role=document.getElementById('roleSelect').value;
    if(!role){ msg.textContent='Select Student or Teacher'; return; }
    userName=role+" User"; userRole=role;
  } else { userName='Guest'; userRole='Guest'; }
  document.getElementById('loginPage').style.display='none';
  document.getElementById('appPage').style.display='flex';
  document.getElementById('welcomeUser').innerText=userName;
  loadSubjects();
}

// ========== NAVIGATION ==========
function navigate(e){
  document.querySelectorAll('#sidebar .nav-btn').forEach(b=>b.classList.remove('active'));
  e.currentTarget.classList.add('active');
  const page=e.currentTarget.dataset.page;
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(page).classList.add('active');
  if(page==='subjectsPage') loadSubjects();
  if(page==='topicPage') renderTopics();
  if(page==='mindmapPage') loadFlowchartTopics();
}

// ========== SUBJECTS & TOPICS ==========
const subjects = ["Grammar","Formal Letter","Speech","Prose","Algebra","Linear Equations"];
const subjectTopics = {"Grammar":["Grammar"],"Formal Letter":["Formal Letter"],"Speech":["Speech"],"Algebra":["Algebra"],"Linear Equations":["Linear Equations"],"Prose":["Prose"]};

function loadSubjects(){
  const quick=document.getElementById('subjectsQuick');
  const list=document.getElementById('subjectsList');
  quick.innerHTML=''; list.innerHTML='';
  subjects.forEach(sub=>{
    const btnQuick=document.createElement('button');
    btnQuick.className='subject-card'; btnQuick.innerText=sub;
    btnQuick.onclick=()=>selectSubject(sub); quick.appendChild(btnQuick);
    const btnList=document.createElement('button');
    btnList.className='subject-card'; btnList.innerText=sub;
    btnList.onclick=()=>selectSubject(sub); list.appendChild(btnList);
  });
}

function selectSubject(sub){
  selectedSubject=sub; chosenTopic=subjectTopics[sub][0];
  navigate({currentTarget:{dataset:{page:'topicPage'}}, preventDefault:()=>{}});
}

function renderTopics(){
  const container=document.getElementById('topicsList'); container.innerHTML='';
  if(!selectedSubject) return;
  subjectTopics[selectedSubject].forEach(t=>{
    const btn=document.createElement('button'); btn.className='subject-card'; btn.innerText=t;
    btn.onclick=()=>{ chosenTopic=t; };
    container.appendChild(btn);
  });
}

// ========== FLOWCHART - GUARANTEED WORKING ==========
function loadFlowchartTopics(){
  const select = document.getElementById('mindmapTopicSelect');
  select.innerHTML = '<option value="">Select a topic</option>';
  Object.keys(flowchartData).forEach(topic => {
    const option = document.createElement('option');
    option.value = topic;
    option.text = topic;
    select.appendChild(option);
  });
}

function generateFlowchart(){
  const topic = document.getElementById('mindmapTopicSelect').value;
  const container = document.getElementById('mindmapContainer');
  
  if(!topic || !flowchartData[topic]){
    showToast('Select Grammar, Algebra, Speech, etc. first!', 'error');
    return;
  }
  
  const steps = flowchartData[topic].steps;
  container.innerHTML = '';
  
  steps.forEach((step, index) => {
    const node = document.createElement('div');
    node.className = `flow-node ${step.type}`;
    node.innerHTML = `
      <div class="title">${step.title}</div>
      <div class="points">${step.points}</div>
    `;
    
    // Add arrows between nodes
    if(index < steps.length - 1){
      const arrow = document.createElement('div');
      arrow.className = 'flow-arrow right';
      node.appendChild(arrow);
    }
    
    container.appendChild(node);
  });
  
  showToast(`✅ ${topic} Flowchart Generated! Follow the steps →`, 'success');
}

// ========== OTHER FUNCTIONS (SIMPLIFIED) ==========
function loadQuiz(){ document.getElementById('quizOutput').innerHTML='Quiz for '+chosenTopic; }
function loadWorksheet(){ document.getElementById('wsOutput').innerHTML='Worksheet for '+chosenTopic; }
function submitHomework(){
  document.getElementById('homeworkMessage').innerHTML='✅ Homework Submitted!';
  document.getElementById('homeworkMessage').style.cssText='background:rgba(60,212,139,0.2);color:#3cd48b;display:block;padding:12px;border-radius:10px;';
  setTimeout(()=>document.getElementById('homeworkMessage').style.display='none', 2000);
}
function sendMessage(){
  const input=document.getElementById('chatInput');
  const chatBox=document.getElementById('chatBox');
  let msg=input.value.trim(); if(!msg) return; input.value='';
  chatBox.innerHTML+=`<div><b>You:</b> ${msg}</div><div><b>AI:</b> Great question!</div>`;
  chatBox.scrollTop=chatBox.scrollHeight;
}

function showToast(msg,type='success'){
  const t=document.createElement('div'); 
  t.className='toast '+(type==='success'?'success':'error'); 
  t.innerText=msg;
  document.body.appendChild(t); 
  setTimeout(()=>t.remove(),2500);
}
</script>
</body>
</html>
